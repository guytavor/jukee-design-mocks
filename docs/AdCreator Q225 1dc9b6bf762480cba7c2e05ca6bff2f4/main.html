<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Jukee Ad Creator – Mock (v4 full chips + history)</title>
    <style>
        /* Base styles and reset */
        *{box-sizing:border-box}
        body{
            margin:0;
            font-family:"SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            min-height:100vh;
            display:flex;
            flex-direction:column;
            color:#333;
            background-color:#f9fafb;
            line-height:1.5;
        }
        
        /* Mode controls */
        body.tweak-mode #main{display:none}
        body.tweak-mode #modeIndicator{display:flex}
        
        /* Layout containers */
        #main{
            flex:0 0 auto;
            display:flex;
            flex-direction:column;
            background-color:#fff;
            border-radius:0 0 12px 12px;
            box-shadow:0 2px 10px rgba(0,0,0,0.05);
            margin:0 24px 24px;
        }
        #promptPanel{
            padding:32px 32px 16px;
            display:flex;
            flex-direction:column;
            gap:20px;
        }
        #chipPanel{
            padding:16px 32px 32px;
        }
        
        /* Prompt input */
        textarea#prompt{
            width:100%;
            height:120px;
            resize:none;
            border:1px solid #e0e4e8;
            border-radius:8px;
            padding:16px;
            font-size:16px;
            box-shadow:0 1px 3px rgba(0,0,0,0.05) inset;
            transition:border-color 0.2s, box-shadow 0.2s;
        }
        textarea#prompt:focus{
            outline:none;
            border-color:#0066FF;
            box-shadow:0 0 0 3px rgba(0,102,255,0.15);
        }
        
        /* Chip groups and chips */
        .chip-group{
            margin-bottom:12px;
            position:relative;
            background:#f8fafd;
            border:1px solid #e0e4e8;
            border-radius:8px;
            padding:10px 16px;
            flex:1;
            min-width:200px;
        }
        .chip-group h4{
            margin:0 0 8px 0;
            font-size:11px;
            color:#666;
            text-transform:uppercase;
            letter-spacing:1px;
            font-weight:600;
            display:inline-block;
            position:relative;
        }
        .chip-group h4::after {
            content: "";
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 1px;
            background: rgba(0,102,255,0.2);
        }
        .chips{
            display:flex;
            flex-wrap:wrap;
            gap:6px;
        }
        .chip{
            background:#f5f7fa;
            border:1px solid #e0e4e8;
            border-radius:14px;
            padding:4px 10px;
            font-size:12px;
            cursor:pointer;
            user-select:none;
            transition:all 180ms ease;
            display:inline-flex;
            align-items:center;
            gap:4px;
            font-weight:500;
            box-shadow:0 1px 2px rgba(0,0,0,0.04);
        }
        .chip:hover{
            background:#eef1f6;
            border-color:#cdd4df;
            transform:translateY(-1px);
            box-shadow:0 2px 4px rgba(0,0,0,0.08);
        }
        .chip.active{
            background:#0066FF;
            border-color:#0052cc;
            color:#fff;
            box-shadow:0 2px 4px rgba(0,102,255,0.25);
        }
        .chip.active:hover{
            background:#0055e6;
        }
        .chip.disabled{
            opacity:0.5;
            border-color:#ddd;
            color:#999;
            cursor:default;
            pointer-events:none;
            box-shadow:none;
        }
        .chip-group.disabled-group{
            opacity:0.5;
            pointer-events:none;
        }
        
        /* Flag and dropdown */
        .flag{
            width:16px;
            height:12px;
            object-fit:cover;
            border-radius:2px;
            box-shadow:0 1px 2px rgba(0,0,0,0.1);
        }
        .dropdown{
            display:none;
            position:absolute;
            top:60px;
            left:0;
            width:100%;
            max-height:280px;
            overflow-y:auto;
            border:1px solid #e0e4e8;
            border-radius:8px;
            background:#fff;
            box-shadow:0 4px 15px rgba(0,0,0,.12);
            z-index:10;
        }
        .dropdown-item{
            padding:10px 16px;
            display:flex;
            align-items:center;
            gap:12px;
            font-size:14px;
            cursor:pointer;
            transition:background 120ms;
        }
        .dropdown-item:hover{
            background:#f5f7fa;
        }
        
        /* Action bar */
        #actionBar{
            padding:16px 24px;
            border-top:1px solid #eaeef2;
            display:flex;
            gap:16px;
            align-items:center;
            background-color:#fff;
            margin:0 24px;
            border-radius:8px;
            box-shadow:0 2px 6px rgba(0,0,0,0.05);
            position:relative;
        }
        
        /* Buttons */
        button{
            border:none;
            border-radius:6px;
            padding:12px 24px;
            font-size:14px;
            font-weight:500;
            cursor:pointer;
            transition:all 180ms ease;
        }
        button:hover{
            transform:translateY(-1px);
        }
        button:active{
            transform:translateY(0);
        }
        button.primary{
            background:#0066FF;
            color:#fff;
            box-shadow:0 2px 4px rgba(0,102,255,0.25);
        }
        button.primary:hover{
            background:#0055e6;
            box-shadow:0 4px 8px rgba(0,102,255,0.25);
        }
        button.secondary{
            background:#f5f7fa;
            color:#333;
            border:1px solid #e0e4e8;
            box-shadow:0 1px 2px rgba(0,0,0,0.04);
        }
        button.secondary:hover{
            background:#eef1f6;
            border-color:#cdd4df;
            box-shadow:0 2px 4px rgba(0,0,0,0.08);
        }
        button.primary:disabled{
            background:#a5b4fb;
            cursor:default;
            box-shadow:none;
            transform:none;
        }
        /* Output section and previews */
        #output{
            flex:1;
            padding:32px 24px;
            display:flex;
            flex-direction:column;
            gap:32px;
            background:#f5f7fa;
            overflow-y:auto;
        }
        .output-card{
            width:100%;
            margin:0 auto;
            border:1px solid #e0e4e8;
            border-radius:12px;
            padding:24px;
            display:flex;
            flex-direction:column;
            gap:16px;
            background:#fff;
            transition:all 0.25s ease;
            box-shadow:0 3px 10px rgba(0,0,0,0.08);
        }
        .output-card.selected{
            border-color:#0066FF;
            box-shadow:0 0 0 2px rgba(0,102,255,0.15), 0 8px 16px rgba(0,0,0,0.08);
            transform:translateY(-2px);
        }
        .output-card:not(.selected){
            opacity:0.9;
        }
        .output-card:not(.selected):hover{
            border-color:#a6c8ff;
            opacity:1;
            transform:translateY(-1px);
            box-shadow:0 6px 12px rgba(0,0,0,0.1);
        }
        .output-card:not(.selected) .btn-select{
            display:none;
        }
        .output-card:not(.selected):hover .btn-select{
            display:inline-block;
        }
        /* Hide Save & Download and Share buttons on non-selected cards */
        .output-card:not(.selected) .btn-save,
        .output-card:not(.selected) .btn-share{
            display:none !important;
        }
        .output-card.selected .btn-select{
            display:none !important;
        }
        
        /* Tweak panel */
        .tweaking .tweak-panel{
            display:block;
        }
        .tweaking .btn-row{
            display:none;
        } 
        .tweak-panel{
            display:none;
            margin-top:20px;
            border-top:1px solid #eaeef2;
            padding-top:20px;
        }
        
        /* Tweak panel styles */
        .section{
            padding:20px 0;
            border-bottom:1px solid #eaeef2;
            display:flex;
            flex-direction:column;
            gap:16px;
        }
        .section h4{
            margin:0;
            font-size:13px;
            text-transform:uppercase;
            color:#666;
            letter-spacing:1px;
            font-weight:600;
        }
        .range-wrap{
            display:flex;
            align-items:center;
            gap:12px;
        }
        .range-wrap span{
            font-size:14px;
            color:#666;
            width:36px;
            text-align:right;
            font-weight:500;
        }
        .range-wrap input[type="range"]{
            -webkit-appearance:none;
            width:100%;
            height:6px;
            background:#e0e4e8;
            border-radius:3px;
            outline:none;
        }
        .range-wrap input[type="range"]::-webkit-slider-thumb{
            -webkit-appearance:none;
            width:16px;
            height:16px;
            background:#0066FF;
            border-radius:50%;
            cursor:pointer;
            box-shadow:0 1px 3px rgba(0,0,0,0.2);
            transition:all 0.15s ease;
        }
        .range-wrap input[type="range"]::-webkit-slider-thumb:hover{
            transform:scale(1.15);
            box-shadow:0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Timing axis styles - dots only, no fill */
        .timing-range{
            -webkit-appearance:none;
            width:100%;
            height:6px;
            background:#e0e4e8;
            border-radius:3px;
            outline:none;
        }
        .timing-range::-webkit-slider-thumb{
            -webkit-appearance:none;
            width:16px;
            height:16px;
            background:#0066FF;
            border-radius:50%;
            cursor:pointer;
            box-shadow:0 1px 3px rgba(0,0,0,0.2);
            transition:all 0.15s ease;
        }
        .timing-range::-webkit-slider-thumb:hover{
            transform:scale(1.15);
            box-shadow:0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Custom timing component with duration visualization */
        .timing-track{
            position:relative;
            width:100%;
            height:6px;
            background:#e0e4e8;
            border-radius:3px;
        }
        .timing-handle{
            position:absolute;
            top:-5px;
            width:16px;
            height:16px;
            background:#0066FF;
            border-radius:50%;
            cursor:pointer;
            box-shadow:0 1px 3px rgba(0,0,0,0.2);
            transition:all 0.15s ease;
            z-index:2;
        }
        .timing-handle:hover{
            transform:scale(1.15);
            box-shadow:0 2px 4px rgba(0,0,0,0.3);
        }
        .duration-line{
            position:absolute;
            top:0;
            height:6px;
            background:#ff4444;
            border-radius:0 3px 3px 0;
            z-index:1;
        }
        
        /* SFX items */
        .sfx-item{
            display:flex;
            align-items:center;
            justify-content:space-between;
            gap:12px;
            padding:8px 12px;
            background:#f8fafd;
            border-radius:8px;
            border:1px solid #e0e4e8;
        }
        
        /* Timing items with aligned labels */
        .timing-item{
            display:grid;
            grid-template-columns:120px 40px 1fr auto;
            align-items:center;
            gap:12px;
            padding:8px 12px;
            background:#f8fafd;
            border-radius:8px;
            border:1px solid #e0e4e8;
            margin-bottom:8px;
        }
        
        /* Edit button for timing items */
        .timing-edit-btn{
            width:32px;
            height:24px;
            background:#e0e4e8;
            border:none;
            border-radius:4px;
            cursor:pointer;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:12px;
            transition:all 0.15s ease;
        }
        .timing-edit-btn:hover{
            background:#0066FF;
            color:#fff;
        }
        .timing-item span:first-child{
            font-weight:500;
        }
        
        /* Vertical slider for music volume */
        .vertical-slider{
            writing-mode: bt-lr; /* IE */
            -webkit-appearance: slider-vertical; /* WebKit */
            width: 20px;
            height: 150px;
            background: #e0e4e8;
            outline: none;
        }
        
        /* Modal styles */
        .modal-overlay{
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:rgba(0,0,0,0.5);
            display:none;
            z-index:1000;
            align-items:center;
            justify-content:center;
        }
        .modal-content{
            background:#fff;
            border-radius:12px;
            padding:32px;
            max-width:1000px;
            width:90vw;
            max-height:85vh;
            overflow-y:auto;
            box-shadow:0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:20px;
        }
        .modal-close{
            background:none;
            border:none;
            font-size:24px;
            cursor:pointer;
            color:#666;
        }
        
        /* Volume modal styles */
        .volume-modal-content{
            background:#fff;
            border-radius:12px;
            padding:20px;
            width:180px;
            height:320px;
            display:flex;
            flex-direction:column;
            box-shadow:0 10px 30px rgba(0,0,0,0.3);
            position:absolute;
        }
        .volume-modal-overlay{
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background:transparent;
            display:none;
            z-index:1000;
        }
        .sfx-item span{
            font-size:14px;
            font-weight:500;
        }
        .sfx-remove{
            background:none;
            border:none;
            font-size:16px;
            cursor:pointer;
            color:#888;
            width:24px;
            height:24px;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            transition:all 0.15s ease;
        }
        .sfx-remove:hover{
            background:#f1f1f1;
            color:#555;
        }
        
        /* Voice and music lists */
        .voice-list, .music-list{
            display:flex;
            flex-direction:column;
            gap:10px;
        }
        .list-container{
            max-height:200px;
            overflow-y:auto;
            padding-right:8px;
            margin-top:8px;
        }
        .voice-row, .music-row{
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:16px 16px;
            border:1px solid #e0e4e8;
            border-radius:8px;
            transition:all 0.15s ease;
            background:#fff;
            box-shadow:0 1px 3px rgba(0,0,0,0.05);
            min-height:70px;
        }
        .voice-row:hover, .music-row:hover{
            background:#f8fafd;
            border-color:#cdd4df;
            transform:translateY(-1px);
            box-shadow:0 2px 5px rgba(0,0,0,0.08);
        }
        .voice-row.selected, .music-row.selected{
            border-color:#0066FF !important;
            background:#f8fafd !important;
        }
        /* Voice row select buttons */
        .voice-row:not(.selected) .voice-select-btn.primary{
            display:none !important;
        }
        .voice-row.selected .voice-select-btn.primary{
            display:inline-block !important;
        }
        .voice-row.selected .voice-select-btn.secondary{
            display:none !important;
        }
        .voice-row:not(.selected) .voice-select-btn.secondary{
            display:none !important;
        }
        .voice-row:not(.selected):hover .voice-select-btn.secondary{
            display:inline-block !important;
        }
        /* Music row select buttons */
        .music-row:not(.selected) .music-select-btn.primary{
            display:none !important;
        }
        .music-row.selected .music-select-btn.primary{
            display:inline-block !important;
        }
        .music-row.selected .music-select-btn.secondary{
            display:none !important;
        }
        .music-row:not(.selected) .music-select-btn.secondary{
            display:none !important;
        }
        .music-row:not(.selected):hover .music-select-btn.secondary{
            display:inline-block !important;
        }
        .voice-left, .music-left{
            display:flex;
            flex-direction:column;
            gap:4px;
        }
        .voice-name, .music-name{
            font-size:15px;
            font-weight:600;
            color:#333;
        }
        .voice-desc, .music-desc{
            font-size:13px;
            color:#666;
        }
        .icon-male::before{
            content:"♂️";
            margin-right:8px;
            color:#0066FF;
        }
        .icon-female::before{
            content:"♀️";
            margin-right:8px;
            color:#e91e63;
        }
        
        /* Provider logos */
        .provider-logo{
            display:inline-block;
            width:16px;
            height:16px;
            margin-left:8px;
            opacity:0.5;
            vertical-align:middle;
            filter:grayscale(100%);
            transition:opacity 0.2s;
        }
        .voice-row:hover .provider-logo{
            opacity:0.7;
        }
        .provider-openai{
            background:url('data:image/svg+xml;base64,CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPgogIDxpbWFnZSBocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQVFDQUFBQUFBNm1LQzlBQUFBUkdWWVNXWk5UUUFxQUFBQUNBQUJoMmtBQkFBQUFBRUFBQUFhQUFBQUFBQURvQUVBQXdBQUFBRUFBUUFBb0FJQUJBQUFBQUVBQUFNZ29BTUFCQUFBQUFFQUFBTWdBQUFBQU1DVXpUOEFBQUViU1VSQlZIaWNBUkFCNy80QS8vLy8vOTFMRVE4dXN2Ly8vLy8vL3dELy8vL21KbVBPNFlJR1AwZUc3Ly8vQWY4QThHejZxZ0NrakI1VC9LZnR0aGtBLzZzaUFzYmJQeTZ4L3VYLy8xWmQvd0M4RmFJdTFZaHErOVJlSTF2ZjRDTHJBbjF1WFFEOUJDNThQa3ZHQ0VDVEJQVUUyMGdBL2dNQm1YazVudXFZMEc3dUNnUUo2UUQ5NXdGN1V3QURmY0Z1djBtS0FIUkErTUZUTDdELy82Nk92U1QvdGgwQTZ4UTV5L3FUVGE2cU1veldKdjNNRlFUMkVqaFRSSVlZWkdOcDhmMEJBcm9rQU9zaTMrQmRKRjNUKzJ5SDFpaWpGN3dBLzE1VS8vL20vckl1UGRySEFpV3Mvd0gvNkVvUldRV3U0SE5lQUZjRmxROEFBUC8vNzRaSFB3YUM0dEJrSnVYLy8vOEEvLy8vLy8vL3NpNFBFVXZkLy8vLy8zQWlrQmJUV2ZDbEFBQUFBRWxGVGtTdVFtQ0MiIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIvPgo8L3N2Zz4K');
            background-size:contain;
        }
        .provider-google{
            background:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE0LjUzNzUgNi43NUgxNEg4VjkuNUgxMS43ODEyQzExLjI5MzcgMTEuMzEyNSA5Ljc4MTI1IDEyLjUgOCAxMi41QzUuNTE1NjIgMTIuNSAzLjUgMTAuNDg0NCAzLjUgOEMzLjUgNS41MTU2MiA1LjUxNTYyIDMuNSA4IDMuNUM5LjIxODc1IDMuNSAxMC4zMTI1IDMuOTY4NzUgMTEuMTM3NSA0LjcyNUwxMy4xMTI1IDIuNzVDMTEuNzUgMS40Njg3NSA5Ljk2ODc1IDAuNSA4IDAuNUMzLjg1OTM4IDAuNSAwLjUgMy44NTkzOCAwLjUgOEMwLjUgMTIuMTQwNiAzLjg1OTM4IDE1LjUgOCAxNS41QzEyLjE0MDYgMTUuNSAxNS41IDEyLjE0MDYgMTUuNSA4QzE1LjUgNy41NjI1IDE1LjQzNzUgNy4xNDA2MiAxNC41Mzc1IDYuNzVaIiBmaWxsPSIjNDI4NUY0Ii8+Cjwvc3ZnPgo=') no-repeat center;
            background-size:contain;
        }
        .provider-elevenlabs{
            background:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIgMlYxNEgxNFYySDJaIiBmaWxsPSIjMDAwMDAwIi8+CjxwYXRoIGQ9Ik01IDVWMTFNOCA1VjExTTExIDVWMTEiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4KPC9zdmc+') no-repeat center;
            background-size:contain;
        }
        
        /* Pulse animation for recording */
        @keyframes pulse {
            0% {
                box-shadow: 0 4px 12px rgba(255,68,68,0.3);
            }
            50% {
                box-shadow: 0 4px 20px rgba(255,68,68,0.6);
            }
            100% {
                box-shadow: 0 4px 12px rgba(255,68,68,0.3);
            }
        }
        
        /* Brand chime options */
        .brand-chime-options{
            display:flex;
            gap:16px;
        }
        .brand-chime-options label{
            display:flex;
            align-items:center;
            gap:8px;
            font-size:14px;
            cursor:pointer;
        }
        .brand-chime-options input[type="checkbox"]{
            width:18px;
            height:18px;
            accent-color:#0066FF;
        }
        
        /* SFX Modal Row styles */
        .sfx-modal-row:hover{
            background:#f8fafd !important;
            border-color:#cdd4df !important;
            transform:translateY(-1px);
            box-shadow:0 2px 5px rgba(0,0,0,0.08) !important;
            cursor:pointer;
        }
        .sfx-modal-row.selected{
            border-color:#0066FF !important;
            background:#f0f8ff !important;
        }
        /* Show/hide select buttons */
        .sfx-modal-row:not(.selected) .sfx-select-btn.primary{
            display:none !important;
        }
        .sfx-modal-row.selected .sfx-select-btn.primary{
            display:inline-block !important;
        }
        .sfx-modal-row.selected .sfx-select-btn.secondary{
            display:none !important;
        }
        .sfx-modal-row:not(.selected) .sfx-select-btn.secondary{
            display:none !important;
        }
        .sfx-modal-row:not(.selected):hover .sfx-select-btn.secondary{
            display:inline-block !important;
        }
        
        /* Audio Player Component */
        .audio-player {
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e5e5;
        }

        .player-top {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .play-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d4d4d4 0%, #b8b8b8 100%);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            transition: background 0.2s ease;
        }

        .play-button:hover {
            background: linear-gradient(135deg, #c4c4c4 0%, #a8a8a8 100%);
        }

        .play-icon {
            width: 0;
            height: 0;
            border-left: 8px solid #4a4a4a;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            margin-left: 2px;
        }

        .track-title {
            font-size: 16px;
            color: #333;
            font-weight: 400;
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .time-display {
            font-size: 13px;
            color: #666;
            min-width: 28px;
            text-align: center;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: #e5e5e5;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: #4a90e2;
            border-radius: 2px;
            width: 2%;
            transition: width 0.1s ease;
        }

        .progress-handle {
            position: absolute;
            top: 50%;
            left: 2%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: #4a90e2;
            border-radius: 50%;
            cursor: pointer;
            transition: left 0.1s ease;
        }
        
        /* Button row */
        .btn-row{
            display:flex;
            gap:12px;
            justify-content:space-between;
        }
        /* History drawer */
        #historyDrawer{
            position:fixed;
            top:0;
            right:-380px;
            width:360px;
            height:100%;
            background:#fff;
            border-left:1px solid #e0e4e8;
            box-shadow:-4px 0 20px rgba(0,0,0,.15);
            display:flex;
            flex-direction:column;
            transition:right 300ms cubic-bezier(0.19, 1, 0.22, 1);
            z-index:50;
        }
        #historyDrawer.open{
            right:0;
        }
        #historyHeader{
            padding:20px 24px;
            font-weight:600;
            font-size:18px;
            border-bottom:1px solid #eaeef2;
            display:flex;
            justify-content:space-between;
            align-items:center;
            box-shadow:0 2px 5px rgba(0,0,0,.03);
        }
        #historyList{
            flex:1;
            overflow-y:auto;
            padding:8px 0;
        }
        .history-item{
            padding:20px 24px;
            border-bottom:1px solid #eaeef2;
            transition:all 0.2s ease;
            position:relative;
        }
        .history-item:hover{
            background:#f8fafd;
        }
        .history-item::before{
            content:"";
            position:absolute;
            left:0;
            top:50%;
            transform:translateY(-50%);
            width:3px;
            height:0;
            background:#0066FF;
            transition:height 0.2s ease;
        }
        .history-item:hover::before{
            height:60%;
        }
        .hi-title{
            font-size:15px;
            font-weight:600;
            color:#333;
            display:flex;
            align-items:center;
            flex-wrap:wrap;
            gap:8px;
        }
        .hi-tag{
            display:inline-flex;
            align-items:center;
            padding:2px 8px;
            border-radius:12px;
            font-size:11px;
            font-weight:500;
            text-transform:uppercase;
            letter-spacing:0.5px;
        }
        .hi-tag[style*="background:#e0f2ff"]{
            background:#e1f5fe !important;
            color:#0277bd !important;
        }
        .hi-tag[style*="background:#f0fff0"]{
            background:#e8f5e9 !important;
            color:#2e7d32 !important;
        }
        .hi-meta{
            font-size:13px;
            color:#666;
            margin-top:6px;
            display:flex;
            align-items:center;
            gap:8px;
        }
        .hi-meta::before{
            content:"";
            display:inline-block;
            width:6px;
            height:6px;
            border-radius:50%;
            background:#aaa;
        }
        .text{
            font-size:14px;
            color:#555;
            font-style:italic;
            margin:12px 0;
            line-height:1.5;
            position:relative;
            padding-left:16px;
        }
        .text::before{
            content:""";
            position:absolute;
            left:0;
            top:0;
            font-size:24px;
            color:#0066FF;
            line-height:1;
            opacity:0.4;
        }
    </style>
</head>
<body>
<div id="modeIndicator" style="display:none;background:#EBF6FF;color:#0066FF;padding:16px 32px;font-weight:600;align-items:center;justify-content:space-between;border-bottom:1px solid #cce5ff;box-shadow:0 2px 8px rgba(0,0,0,0.05)">
    <span><span style="margin-right:8px;font-size:20px;">✏️</span> Tweak Mode: Fine-tuning your selected preview</span>
    <button class="secondary" id="returnToGenButton" onclick="document.querySelectorAll('.output-card.tweaking').forEach(card => card.classList.remove('tweaking')); document.body.classList.remove('tweak-mode');">Return to Generation</button>
</div>
<div id="main">
    <section id="promptPanel">
        <h2 style="margin:0 0 16px;font-size:24px;color:#333;font-weight:600;">Create Your Ad</h2>
        <input type="text" id="adName" placeholder="Ad Name..." style="width:100%;padding:12px;font-size:14px;border:1px solid #e0e4e8;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.05) inset;margin-bottom:16px;">
        <textarea id="prompt" placeholder="Describe your ad… e.g. 'Christmas tree for €100, funky bed, male Hebrew VO, brand chime first'"></textarea>
    </section>
    <section id="chipPanel">
        <div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:12px;">
            <!-- Tone -->
            <div class="chip-group" id="toneGroup"><h4>Tone</h4>
                <div class="chips">
                    <span class="chip active">Hard Sell</span>
                    <span class="chip">Soft Sell</span>
                    <span class="chip">Story-Teller</span>
                    <span class="chip">Friendly Informative</span>
                    <span class="chip">Urgent Flash-Sale</span>
                </div>
            </div>
            <!-- Voice -->
            <div class="chip-group" id="voicePrefGroup"><h4>Voice Preference</h4>
                <div class="chips">
                    <span class="chip active">Male</span>
                    <span class="chip">Female</span>
                    <span class="chip">Child</span>
                    <span class="chip">Bilingual</span>
                    <span class="chip">Celebrity-Like</span>
                </div>
            </div>
            <!-- Duration -->
            <div class="chip-group"><h4>Duration</h4>
                <div class="chips">
                    <span class="chip">6 s</span>
                    <span class="chip active">12 s</span>
                    <span class="chip">20 s</span>
                    <span class="chip">30 s</span>
                </div>
            </div>
            <!-- Music -->
            <div class="chip-group"><h4>Music Style</h4>
                <div class="chips">
                    <span class="chip active">Funk</span>
                    <span class="chip">Synth-pop</span>
                    <span class="chip">Acoustic Chill</span>
                    <span class="chip">Orchestral</span>
                    <span class="chip">No Music</span>
                </div>
            </div>
            <!-- Chime -->
            <div class="chip-group"><h4>Chime / Logo</h4>
                <div class="chips">
                    <span class="chip active">Brand Chime</span>
                    <span class="chip">Retailer Jingle</span>
                    <span class="chip">No Chime</span>
                </div>
            </div>
            
            <!-- Store Variables -->
            <div class="chip-group"><h4>Store Variables</h4>
                <div class="chips">
                    <span class="chip">$price</span>
                    <span class="chip">$shelf-location</span>
                </div>
            </div>
        
            <!-- Language -->
            <div class="chip-group" id="langGroup"><h4>Language</h4>
                <div class="chips">
                    <span class="chip" id="langChip">
                        <img class="flag" src="https://flagcdn.com/us.svg" alt="US"/> English (US) ▾
                    </span>
                </div>
                <div class="dropdown" id="langDropdown">
                    <div class="dropdown-item"><img class="flag" src="https://flagcdn.com/us.svg"/> English (US)</div>
                    <div class="dropdown-item"><img class="flag" src="https://flagcdn.com/gb.svg"/> English (UK)</div>
                    <div class="dropdown-item"><img class="flag" src="https://flagcdn.com/fr.svg"/> French (FR)</div>
                    <div class="dropdown-item"><img class="flag" src="https://flagcdn.com/de.svg"/> German (DE)</div>
                    <div class="dropdown-item"><img class="flag" src="https://flagcdn.com/es.svg"/> Spanish (ES)</div>
                    <div class="dropdown-item"><img class="flag" src="https://flagcdn.com/il.svg"/> Hebrew (IL)</div>
                </div>
            </div>
            <!-- SFX -->
            <div class="chip-group"><h4>SFX</h4>
                <button class="secondary" style="padding:4px 10px;font-size:12px;" onclick="openSfxModal()">+ Add SFX</button>
            </div>
            <!-- Import Voice Over -->
            <div class="chip-group" id="importGroup"><h4>Voice Over</h4>
                <button class="secondary" id="importBtn" style="padding:4px 10px;font-size:12px;">Import Voice Over</button>
                <input type="file" id="importInput" accept="audio/*" style="display:none"/>
                <div id="importedFile" style="display:none; margin-top:8px; font-size:12px; align-items:center;">
                    <span id="fileName"></span>
                    <button class="secondary" id="removeFileBtn" style="margin-left:6px; padding:2px 6px; font-size:10px;">X</button>
                </div>
                <small style="color:#666; display:block; margin-top:6px;font-size:10px;">Importing a voice will disable Tone & Voice Preference</small>
            </div>
        </div>
    </section>
</div>
<div id="actionBar">
    <button class="secondary" id="historyBtn" style="position:absolute;left:24px;">History ▾</button>
    <div style="display:flex;gap:12px;margin:0 auto;">
        <button class="secondary">Reset</button>
        <button class="primary" style="display:flex;align-items:center;gap:6px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7.5 5.6L10 7L8.6 4.5L10 2L7.5 3.4L5 2L6.4 4.5L5 7L7.5 5.6M19.5 15.4L17 14L18.4 16.5L17 19L19.5 17.6L22 19L20.6 16.5L22 14L19.5 15.4M22 2L20.6 4.5L22 7L19.5 5.6L17 7L18.4 4.5L17 2L19.5 3.4L22 2M13.34 12.78L15.78 10.34L13.66 8.22L11.22 10.66L13.34 12.78M14.37 7.29L16.71 9.63C17.1 10.02 17.1 10.65 16.71 11.04L11.04 16.71C10.65 17.1 10.02 17.1 9.63 16.71L7.29 14.37C6.9 13.98 6.9 13.35 7.29 12.96L12.96 7.29C13.35 6.9 13.98 6.9 14.37 7.29Z"/>
            </svg>
            Generate
        </button>
    </div>
</div>
<section id="output">
    <div class="output-card selected">
        <div class="audio-player">
            <div class="player-top">
                <button class="play-button" onclick="toggleAudioPlayer(this)">
                    <div class="play-icon"></div>
                </button>
                <div class="track-title">Generated Preview 1</div>
            </div>
            
            <div class="progress-container">
                <div class="time-display">0:00</div>
                <div class="progress-bar" onclick="setAudioProgress(this, event)">
                    <div class="progress-fill"></div>
                    <div class="progress-handle"></div>
                </div>
                <div class="time-display">0:12</div>
            </div>
        </div>
        <div class="btn-row">
            <button class="secondary" onclick="this.closest('.output-card').classList.toggle('tweaking'); document.body.classList.toggle('tweak-mode');" style="display:flex;align-items:center;gap:6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                </svg>
                Tweak
            </button>
            <div style="display:flex;gap:8px;">
                <button class="primary btn-save" onclick="saveAndDownload()" style="display:flex;align-items:center;gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Save & Download
                </button>
                <button class="primary btn-share" onclick="shareAd()" style="display:flex;align-items:center;gap:6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    Share
                </button>
            </div>
            <button class="primary btn-select" onclick="selectPreview(this)" style="display:none;">Select</button>
        </div>
        <div class="tweak-panel">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <h3 style="margin:0;font-size:16px;font-weight:600;">Tweak Ad</h3>
                <button style="background:none;border:none;font-size:22px;cursor:pointer" onclick="this.closest('.output-card').classList.toggle('tweaking'); document.body.classList.toggle('tweak-mode');">×</button>
            </div>
            
            <!-- Timing -->
            <div class="section">
                <h4>Timing</h4>
                
                <!-- Ad Length -->
                <div class="timing-item">
                    <span>Ad Length</span>
                    <span></span>
                    <div style="display:flex;align-items:center;justify-content:center;">
                        <button onclick="this.nextElementSibling.stepDown()" style="background:#e0e4e8;border:none;padding:4px 8px;border-radius:4px 0 0 4px;cursor:pointer;">−</button>
                        <input type="number" min="1" max="60" value="12" style="width:60px;padding:4px 8px;border:1px solid #c5c5c5;border-left:none;border-right:none;text-align:center;background:#fff;">
                        <button onclick="this.previousElementSibling.stepUp()" style="background:#e0e4e8;border:none;padding:4px 8px;border-radius:0 4px 4px 0;cursor:pointer;">+</button>
                        <span style="margin-left:8px;font-size:12px;color:#666;">sec</span>
                    </div>
                    <span></span>
                </div>
                
                <!-- Music -->
                <div class="timing-item">
                    <span>Music</span>
                    <button class="timing-edit-btn" onclick="openMusicModal()" title="Edit music selection and volume" style="font-size:8px;line-height:1;">🎵<br>Funk</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:0%;"></div>
                        <div class="duration-line" style="left:0%;width:100%;"></div>
                    </div>
                    <span></span>
                </div>
                
                <!-- Voice Over -->
                <div class="timing-item">
                    <span>Voice Over</span>
                    <button class="timing-edit-btn" onclick="openVoiceModal()" title="Edit voice actor selection" style="font-size:8px;line-height:1;">🎤<br>Alex</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:0%;"></div>
                        <div class="duration-line" style="left:0%;width:75%;"></div>
                    </div>
                    <span></span>
                </div>
                
                <!-- Brand Chimes -->
                <div class="timing-item" style="background:#f0f8ff;border-color:#e0e4e8;">
                    <span>Buh-bam</span>
                    <input type="checkbox" checked style="width:18px;height:18px;accent-color:#0066FF;">
                    <div class="timing-track">
                        <div class="duration-line" style="left:0%;width:1.67%;"></div>
                    </div>
                    <span style="font-size:12px;color:#666;">Fixed at start</span>
                </div>
                
                <div class="timing-item">
                    <span>Logo</span>
                    <input type="checkbox" style="width:18px;height:18px;accent-color:#0066FF;">
                    <div class="timing-track">
                        <div class="timing-handle" style="left:90%;"></div>
                        <div class="duration-line" style="left:90%;width:10%;"></div>
                    </div>
                    <span></span>
                </div>
                
                <!-- Sound Effects -->
                <div class="timing-item">
                    <span>Cash Register</span>
                    <button class="timing-edit-btn" onclick="openVolumeModal('Cash Register', 75, this)" title="Adjust volume">🔊</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:20%;"></div>
                        <div class="duration-line" style="left:20%;width:25%;"></div>
                    </div>
                    <button class="sfx-remove">✕</button>
                </div>
                
                <div class="timing-item">
                    <span>Sparkle</span>
                    <button class="timing-edit-btn" onclick="openVolumeModal('Sparkle', 50, this)" title="Adjust volume">🔊</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:60%;"></div>
                        <div class="duration-line" style="left:60%;width:20%;"></div>
                    </div>
                    <button class="sfx-remove">✕</button>
                </div>
                
                <button class="secondary" style="margin-top:8px;" onclick="openSfxModal()">+ Add SFX</button>
            </div>
            
            <!-- Footer -->
            <div style="display:flex;justify-content:center;margin-top:16px;padding-top:16px;border-top:1px solid #e5e5e5;">
                <button class="primary" onclick="simulateGeneration(this)">Generate</button>
            </div>
            
            <!-- Audio Player moved below generate button -->
            <div class="audio-player" style="margin-top:20px;opacity:1;" data-player-id="tweak-1">
                <div class="player-top">
                    <button class="play-button" onclick="toggleAudioPlayer(this)">
                        <div class="play-icon"></div>
                    </button>
                    <div class="track-title">Updated Preview</div>
                </div>
                
                <div class="progress-container">
                    <div class="time-display">0:00</div>
                    <div class="progress-bar" onclick="setAudioProgress(this, event)">
                        <div class="progress-fill"></div>
                        <div class="progress-handle"></div>
                    </div>
                    <div class="time-display">0:12</div>
                </div>
            </div>
        </div>
    </div>
    <div class="output-card">
        <div class="audio-player">
            <div class="player-top">
                <button class="play-button" onclick="toggleAudioPlayer(this)">
                    <div class="play-icon"></div>
                </button>
                <div class="track-title">Generated Preview 2</div>
            </div>
            
            <div class="progress-container">
                <div class="time-display">0:00</div>
                <div class="progress-bar" onclick="setAudioProgress(this, event)">
                    <div class="progress-fill"></div>
                    <div class="progress-handle"></div>
                </div>
                <div class="time-display">0:12</div>
            </div>
        </div>
        <div class="btn-row">
            <button class="secondary" onclick="this.closest('.output-card').classList.toggle('tweaking'); document.body.classList.toggle('tweak-mode');" style="display:flex;align-items:center;gap:6px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                </svg>
                Tweak
            </button>
            <button class="primary btn-select" onclick="selectPreview(this)">Select</button>
        </div>
        <div class="tweak-panel">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <h3 style="margin:0;font-size:16px;font-weight:600;">Tweak Ad</h3>
                <button style="background:none;border:none;font-size:22px;cursor:pointer" onclick="this.closest('.output-card').classList.toggle('tweaking'); document.body.classList.toggle('tweak-mode');">×</button>
            </div>
            
            <!-- Narration Edit -->
            <div class="section">
                <h4>Narration Text</h4>
                <textarea style="width:100%;height:80px;resize:none;border:1px solid #c5c5c5;border-radius:6px;padding:10px;font-size:14px;">Get your Christmas tree today! Only €100 while supplies last!</textarea>
            </div>
            
            
            <!-- Timing -->
            <div class="section">
                <h4>Timing</h4>
                
                <!-- Ad Length -->
                <div class="timing-item">
                    <span>Ad Length</span>
                    <span></span>
                    <div style="display:flex;align-items:center;justify-content:center;">
                        <button onclick="this.nextElementSibling.stepDown()" style="background:#e0e4e8;border:none;padding:4px 8px;border-radius:4px 0 0 4px;cursor:pointer;">−</button>
                        <input type="number" min="1" max="60" value="12" style="width:60px;padding:4px 8px;border:1px solid #c5c5c5;border-left:none;border-right:none;text-align:center;background:#fff;">
                        <button onclick="this.previousElementSibling.stepUp()" style="background:#e0e4e8;border:none;padding:4px 8px;border-radius:0 4px 4px 0;cursor:pointer;">+</button>
                        <span style="margin-left:8px;font-size:12px;color:#666;">sec</span>
                    </div>
                    <span></span>
                </div>
                
                <!-- Music -->
                <div class="timing-item">
                    <span>Music</span>
                    <button class="timing-edit-btn" onclick="openMusicModal()" title="Edit music selection and volume" style="font-size:8px;line-height:1;">🎵<br>Funk</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:0%;"></div>
                        <div class="duration-line" style="left:0%;width:100%;"></div>
                    </div>
                    <span></span>
                </div>
                
                <!-- Voice Over -->
                <div class="timing-item">
                    <span>Voice Over</span>
                    <button class="timing-edit-btn" onclick="openVoiceModal()" title="Edit voice actor selection" style="font-size:8px;line-height:1;">🎤<br>Alex</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:0%;"></div>
                        <div class="duration-line" style="left:0%;width:75%;"></div>
                    </div>
                    <span></span>
                </div>
                
                <!-- Brand Chimes -->
                <div class="timing-item" style="background:#f0f8ff;border-color:#e0e4e8;">
                    <span>Buh-bam</span>
                    <input type="checkbox" checked style="width:18px;height:18px;accent-color:#0066FF;">
                    <div class="timing-track">
                        <div class="duration-line" style="left:0%;width:1.67%;"></div>
                    </div>
                    <span style="font-size:12px;color:#666;">Fixed at start</span>
                </div>
                
                <div class="timing-item">
                    <span>Logo</span>
                    <input type="checkbox" style="width:18px;height:18px;accent-color:#0066FF;">
                    <div class="timing-track">
                        <div class="timing-handle" style="left:90%;"></div>
                        <div class="duration-line" style="left:90%;width:10%;"></div>
                    </div>
                    <span></span>
                </div>
                
                <!-- Sound Effects -->
                <div class="timing-item">
                    <span>Cash Register</span>
                    <button class="timing-edit-btn" onclick="openVolumeModal('Cash Register', 75, this)" title="Adjust volume">🔊</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:20%;"></div>
                        <div class="duration-line" style="left:20%;width:25%;"></div>
                    </div>
                    <button class="sfx-remove">✕</button>
                </div>
                
                <div class="timing-item">
                    <span>Sparkle</span>
                    <button class="timing-edit-btn" onclick="openVolumeModal('Sparkle', 50, this)" title="Adjust volume">🔊</button>
                    <div class="timing-track">
                        <div class="timing-handle" style="left:60%;"></div>
                        <div class="duration-line" style="left:60%;width:20%;"></div>
                    </div>
                    <button class="sfx-remove">✕</button>
                </div>
                
                <button class="secondary" style="margin-top:8px;" onclick="openSfxModal()">+ Add SFX</button>
            </div>
            
            <!-- Footer -->
            <div style="display:flex;justify-content:center;margin-top:16px;padding-top:16px;border-top:1px solid #e5e5e5;">
                <button class="primary" onclick="simulateGeneration(this)">Generate</button>
            </div>
            
            <!-- Audio Player moved below generate button -->
            <div class="audio-player" style="margin-top:20px;opacity:1;" data-player-id="tweak-2">
                <div class="player-top">
                    <button class="play-button" onclick="toggleAudioPlayer(this)">
                        <div class="play-icon"></div>
                    </button>
                    <div class="track-title">Updated Preview</div>
                </div>
                
                <div class="progress-container">
                    <div class="time-display">0:00</div>
                    <div class="progress-bar" onclick="setAudioProgress(this, event)">
                        <div class="progress-fill"></div>
                        <div class="progress-handle"></div>
                    </div>
                    <div class="time-display">0:12</div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- History Drawer -->
<aside id="historyDrawer">
    <div id="historyHeader">
        History <span style="font-weight:400;font-size:13px;">(4)</span>
        <button style="background:none;border:none;font-size:20px;cursor:pointer" onclick="document.getElementById('historyDrawer').classList.toggle('open')">×</button>
    </div>
    <div id="historyList">
        <div class="history-item">
            <div class="hi-title">Alex · Funk Groove · 12s <span class="hi-tag" style="background:#e0f2ff;color:#0066cc;font-size:11px;border-radius:3px;padding:1px 5px;margin-left:4px;">Tweaked</span></div>
            <div class="hi-meta">11:08 Today</div>
            <div class="text">"Grab a lush Christmas tree for only €100 – while stocks last!"</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
                <button class="secondary" style="flex:0;padding:4px 8px;display:flex;align-items:center;gap:4px;">
                    <span style="font-size:14px;">▶</span> Play
                </button>
                <button class="useBtn">Use</button>
                <button class="deleteBtn">Delete</button>
            </div>
        </div>
        <div class="history-item">
            <div class="hi-title">Maya · Acoustic Chill · 30s <span class="hi-tag" style="background:#f0fff0;color:#008800;font-size:11px;border-radius:3px;padding:1px 5px;margin-left:4px;">Published</span></div>
            <div class="hi-meta">10:57 Today</div>
            <div class="text">"Find peace with our winter collection – soft tones, big savings."</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
                <button class="secondary" style="flex:0;padding:4px 8px;display:flex;align-items:center;gap:4px;">
                    <span style="font-size:14px;">▶</span> Play
                </button>
                <button class="useBtn">Use</button>
                <button class="deleteBtn">Delete</button>
            </div>
        </div>
        <div class="history-item">
            <div class="hi-title">No Music · Story-Teller · 20s</div>
            <div class="hi-meta">Yesterday 17:42</div>
            <div class="text">"Once upon a deal… step into our store for magical surprises."</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
                <button class="secondary" style="flex:0;padding:4px 8px;display:flex;align-items:center;gap:4px;">
                    <span style="font-size:14px;">▶</span> Play
                </button>
                <button class="useBtn">Use</button>
                <button class="deleteBtn">Delete</button>
            </div>
        </div>
        <div class="history-item">
            <div class="hi-title">Funk · Urgent Flash-Sale · 6s</div>
            <div class="hi-meta">Yesterday 16:11</div>
            <div class="text">"Flash sale now on! Don't miss out!"</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
                <button class="secondary" style="flex:0;padding:4px 8px;display:flex;align-items:center;gap:4px;">
                    <span style="font-size:14px;">▶</span> Play
                </button>
                <button class="useBtn">Use</button>
                <button class="deleteBtn">Delete</button>
            </div>
        </div>
    </div>
</aside>

<!-- Voice Actor Modal -->
<div id="voiceModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="margin:0;">Select Voice Actor</h3>
            <button class="modal-close" onclick="closeModal('voiceModal')">×</button>
        </div>
        
        <!-- Narration Text -->
        <div style="margin-bottom:24px;">
            <h4 style="margin:0 0 12px 0;font-size:14px;font-weight:600;color:#333;">Narration Text</h4>
            <textarea style="width:100%;height:100px;resize:none;border:1px solid #c5c5c5;border-radius:8px;padding:16px;font-size:16px;line-height:1.4;" placeholder="Enter the text for the voice actor to read...">Grab a lush Christmas tree for only €100 – while stocks last!</textarea>
        </div>
        
        <div style="display:flex;gap:20px;">
            <div style="flex:1;">
                <input type="text" placeholder="Search voices..." style="width:100%;padding:12px 16px;font-size:16px;border:1px solid #c5c5c5;border-radius:8px;background:#fff;margin-bottom:20px;" />
                <div style="max-height:400px;overflow-y:auto;">
                    <div class="voice-list">
                        <div class="voice-row selected" style="border-color:#0066FF;background:#f8fafd;">
                            <div class="voice-left">
                                <div class="voice-name icon-male">Alex<span class="provider-logo provider-openai" title="Powered by OpenAI"></span></div>
                                <div class="voice-desc">Confident, fast-paced announcer</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <span style="color:#0066FF;cursor:pointer;" title="Supports text directions" onclick="openVoiceDirectionModal('Alex')">📝</span>
                                <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;font-size:12px;">▶️ Play Sample</button>
                                <button class="primary" style="width:auto;padding:6px 10px;" data-voice="Alex" data-generated="true">Play</button>
                                <button class="primary voice-select-btn" style="width:auto;padding:6px 10px;">Selected</button>
                                <button class="secondary voice-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectVoiceRow(this)">Select</button>
                            </div>
                        </div>
                        <div class="voice-row">
                            <div class="voice-left">
                                <div class="voice-name icon-female">Maya<span class="provider-logo provider-elevenlabs" title="Powered by ElevenLabs"></span></div>
                                <div class="voice-desc">Friendly and warm tone</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <span style="color:#e91e63;cursor:pointer;" title="Supports voice-to-voice cloning" onclick="openVoice2VoiceModal('Maya')">🎤</span>
                                <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;font-size:12px;">▶️ Play Sample</button>
                                <button class="secondary" style="width:auto;padding:6px 10px;" data-voice="Maya" data-generated="false">Generate</button>
                                <button class="primary voice-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                                <button class="secondary voice-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectVoiceRow(this)">Select</button>
                            </div>
                        </div>
                        <div class="voice-row">
                            <div class="voice-left">
                                <div class="voice-name icon-male">David<span class="provider-logo provider-google" title="Powered by Google"></span></div>
                                <div class="voice-desc">Deep, reassuring tone</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <span style="color:#0066FF;cursor:pointer;" title="Supports text directions" onclick="openVoiceDirectionModal('David')">📝</span>
                                <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;font-size:12px;">▶️ Play Sample</button>
                                <button class="secondary" style="width:auto;padding:6px 10px;" data-voice="David" data-generated="false">Generate</button>
                                <button class="primary voice-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                                <button class="secondary voice-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectVoiceRow(this)">Select</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 20px;">
                <h4 style="writing-mode:vertical-rl;text-orientation:mixed;margin:0 0 8px 0;font-size:11px;">VOLUME</h4>
                <input type="range" class="vertical-slider" min="0" max="100" value="85" style="height:200px;">
                <span style="font-size:12px;color:#666;margin-top:8px;">85%</span>
            </div>
        </div>
    </div>
</div>

<!-- Music Modal -->
<div id="musicModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="margin:0;">Select Music & Volume</h3>
            <button class="modal-close" onclick="closeModal('musicModal')">×</button>
        </div>
        <div style="display:flex;gap:20px;">
            <div style="flex:1;">
                <h4>Music Selection <span style="color:#0066FF;margin-left:8px;cursor:pointer;" title="Add new music bed" onclick="openCreateMusicModal()">➕</span></h4>
                <input type="text" placeholder="Search music..." style="width:100%;padding:12px 16px;font-size:16px;border:1px solid #c5c5c5;border-radius:8px;background:#fff;margin-bottom:20px;" />
                <div style="max-height:400px;overflow-y:auto;">
                    <div class="music-list">
                        <div class="music-row selected" style="border-color:#0066FF;background:#f8fafd;">
                            <div class="music-left">
                                <div class="music-name">Funk Groove</div>
                                <div class="music-desc">Energetic, mid-tempo with bass</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;">▶️ Play</button>
                                <button class="primary music-select-btn" style="width:auto;padding:6px 10px;">Selected</button>
                                <button class="secondary music-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectMusicRow(this)">Select</button>
                            </div>
                        </div>
                        <div class="music-row">
                            <div class="music-left">
                                <div class="music-name">Acoustic Chill</div>
                                <div class="music-desc">Laid-back and warm background</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;">▶️ Play</button>
                                <button class="primary music-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                                <button class="secondary music-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectMusicRow(this)">Select</button>
                            </div>
                        </div>
                        <div class="music-row">
                            <div class="music-left">
                                <div class="music-name">Synth Pop</div>
                                <div class="music-desc">Bright and modern synth layers</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;">▶️ Play</button>
                                <button class="primary music-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                                <button class="secondary music-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectMusicRow(this)">Select</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 20px;">
                <h4 style="writing-mode:vertical-rl;text-orientation:mixed;margin:0 0 8px 0;font-size:11px;">VOLUME</h4>
                <input type="range" class="vertical-slider" min="0" max="100" value="80" style="height:200px;">
                <span style="font-size:12px;color:#666;margin-top:8px;">80%</span>
            </div>
        </div>
    </div>
</div>

<!-- Create Music Modal -->
<div id="createMusicModal" class="modal-overlay">
    <div class="modal-content" style="max-width:800px;">
        <div class="modal-header">
            <h3 style="margin:0;">Create New Music Bed</h3>
            <button class="modal-close" onclick="closeModal('createMusicModal')">×</button>
        </div>
        
        <div style="margin-bottom:24px;">
            <h4 style="margin:0 0 12px 0;font-size:14px;font-weight:600;color:#333;">Describe your music bed</h4>
            <textarea id="musicDescription" style="width:100%;height:80px;resize:none;border:1px solid #c5c5c5;border-radius:8px;padding:16px;font-size:16px;line-height:1.4;" placeholder="e.g., Upbeat electronic music with a driving beat, perfect for energetic retail promotions..."></textarea>
        </div>
        
        <!-- Genre chips -->
        <div style="margin-bottom:24px;">
            <h4 style="margin:0 0 12px 0;font-size:14px;font-weight:600;color:#333;">Select Genres (optional)</h4>
            <div class="chips" style="display:flex;flex-wrap:wrap;gap:8px;">
                <span class="chip">Pop</span>
                <span class="chip">Rock</span>
                <span class="chip">Electronic</span>
                <span class="chip">Jazz</span>
                <span class="chip">Classical</span>
                <span class="chip">R&B</span>
                <span class="chip">Hip-Hop</span>
                <span class="chip">Country</span>
                <span class="chip">Folk</span>
                <span class="chip">Ambient</span>
                <span class="chip">Reggae</span>
                <span class="chip">Blues</span>
                <span class="chip">Latin</span>
                <span class="chip">World</span>
            </div>
        </div>
        
        <!-- Generate button -->
        <div style="display:flex;justify-content:center;margin-bottom:24px;">
            <button class="primary" onclick="generateMusicBed(this)">Generate</button>
        </div>
        
        <!-- Generated music players (hidden initially) -->
        <div id="generatedMusicSection" style="display:none;">
            <h4 style="margin:0 0 16px 0;font-size:14px;font-weight:600;color:#333;">Generated Options</h4>
            <div style="display:flex;flex-direction:column;gap:16px;">
                <!-- Option 1 -->
                <div class="music-row" style="cursor:pointer;" onclick="selectGeneratedMusic(this, 'Generated Music Bed 1')">
                    <div class="music-left">
                        <div class="music-name">Generated Music Bed 1</div>
                        <div class="music-desc">Based on your description</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="event.stopPropagation();">▶️ Play</button>
                        <button class="primary" style="width:auto;padding:6px 10px;">Select</button>
                    </div>
                </div>
                
                <!-- Option 2 -->
                <div class="music-row" style="cursor:pointer;" onclick="selectGeneratedMusic(this, 'Generated Music Bed 2')">
                    <div class="music-left">
                        <div class="music-name">Generated Music Bed 2</div>
                        <div class="music-desc">Alternative version</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="event.stopPropagation();">▶️ Play</button>
                        <button class="primary" style="width:auto;padding:6px 10px;">Select</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Voice Direction Modal -->
<div id="voiceDirectionModal" class="modal-overlay">
    <div class="modal-content" style="max-width:600px;">
        <div class="modal-header">
            <h3 style="margin:0;">Voice Direction</h3>
            <button class="modal-close" onclick="closeModal('voiceDirectionModal')">×</button>
        </div>
        
        <div style="margin-bottom:20px;">
            <p style="margin:0 0 12px 0;font-size:14px;color:#666;">Provide specific directions for how the voice should sound. You can describe tone, emotion, pacing, emphasis, and other vocal characteristics.</p>
        </div>
        
        <div>
            <textarea id="voiceDirectionText" style="width:100%;height:150px;resize:vertical;border:1px solid #c5c5c5;border-radius:8px;padding:16px;font-size:16px;line-height:1.5;" placeholder="Example: Speak with enthusiasm and energy, emphasizing the price. Use a warm, friendly tone that builds excitement. Slow down slightly when mentioning the product name for clarity."></textarea>
        </div>
        
        <div style="display:flex;justify-content:flex-end;margin-top:20px;gap:12px;">
            <button class="secondary" onclick="closeModal('voiceDirectionModal')">Cancel</button>
            <button class="primary" onclick="applyVoiceDirection()">Apply Direction</button>
        </div>
    </div>
</div>

<!-- Voice to Voice Modal -->
<div id="voice2voiceModal" class="modal-overlay">
    <div class="modal-content" style="max-width:700px;">
        <div class="modal-header">
            <h3 style="margin:0;" id="voice2voiceTitle">Voice change to Maya</h3>
            <button class="modal-close" onclick="closeModal('voice2voiceModal')">×</button>
        </div>
        
        <div style="margin-bottom:24px;">
            <p style="margin:0 0 16px 0;font-size:14px;color:#666;">Record yourself reading the narration text below. The system will change your voice to match the selected voice actor while preserving your intonation and emotion.</p>
        </div>
        
        <!-- Narration text display -->
        <div style="margin-bottom:24px;">
            <div style="background:#f8fafd;border:1px solid #e0e4e8;border-radius:8px;padding:16px;font-size:16px;line-height:1.6;color:#333;">
                <p style="margin:0;" id="voice2voiceText">Grab a lush Christmas tree for only €100 – while stocks last!</p>
            </div>
        </div>
        
        <!-- Recording section -->
        <div style="text-align:center;margin-bottom:24px;">
            <button id="recordButton" style="width:80px;height:80px;border-radius:50%;background:#ff4444;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;margin:0 auto;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(255,68,68,0.3);" onclick="toggleRecording()">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                    <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                    <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                </svg>
            </button>
            <p style="margin-top:12px;font-size:14px;color:#666;" id="recordingStatus">Click to start recording</p>
        </div>
        
        <!-- Voice changed result (hidden initially) -->
        <div id="voiceChangedResult" style="display:none;">
            <hr style="border:none;border-top:1px solid #e0e4e8;margin:24px 0;">
            <h4 style="margin:0 0 16px 0;font-size:16px;font-weight:600;">Voice Changed Result</h4>
            <div class="audio-player">
                <div class="player-top">
                    <button class="play-button" onclick="toggleAudioPlayer(this)">
                        <div class="play-icon"></div>
                    </button>
                    <div class="track-title">Voice changed to <span id="targetVoiceName">Maya</span></div>
                </div>
                
                <div class="progress-container">
                    <div class="time-display">0:00</div>
                    <div class="progress-bar" onclick="setAudioProgress(this, event)">
                        <div class="progress-fill"></div>
                        <div class="progress-handle"></div>
                    </div>
                    <div class="time-display">0:03</div>
                </div>
            </div>
        </div>
        
        <div style="display:flex;justify-content:flex-end;margin-top:24px;gap:12px;">
            <button class="secondary" onclick="closeModal('voice2voiceModal')">Cancel</button>
            <button class="primary" id="useVoiceButton" style="display:none;" onclick="useVoiceRecording()">Use This Voice</button>
        </div>
    </div>
</div>

<!-- Sound Effects Modal -->
<div id="sfxModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="margin:0;">Select Sound Effect</h3>
            <button class="modal-close" onclick="closeModal('sfxModal')">×</button>
        </div>
        
        <div style="margin-bottom:24px;">
            <input type="text" id="sfxSearchInput" placeholder="Search sound effects..." style="width:100%;padding:12px 16px;font-size:16px;border:1px solid #c5c5c5;border-radius:8px;background:#fff;" />
        </div>
        
        <div style="max-height:400px;overflow-y:auto;">
            <div class="sfx-list" style="display:flex;flex-direction:column;gap:10px;">
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Cash Register</div>
                        <div style="font-size:13px;color:#666;">Classic ka-ching sound effect</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Cash Register')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
                
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Sparkle</div>
                        <div style="font-size:13px;color:#666;">Magical shimmering sound</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Sparkle')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
                
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Whoosh</div>
                        <div style="font-size:13px;color:#666;">Fast transition swoosh</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Whoosh')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
                
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Bell Ding</div>
                        <div style="font-size:13px;color:#666;">Attention-grabbing bell sound</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Bell Ding')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
                
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Pop</div>
                        <div style="font-size:13px;color:#666;">Playful bubble pop</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Pop')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
                
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Applause</div>
                        <div style="font-size:13px;color:#666;">Crowd clapping sound</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Applause')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
                
                <div class="sfx-modal-row" style="display:flex;align-items:center;justify-content:space-between;padding:16px;border:1px solid #e0e4e8;border-radius:8px;transition:all 0.15s ease;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative;">
                    <div style="display:flex;flex-direction:column;gap:4px;">
                        <div style="font-size:15px;font-weight:600;color:#333;">Coin Drop</div>
                        <div style="font-size:13px;color:#666;">Single coin falling sound</div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;" onclick="playsfxSample('Coin Drop')">▶️ Play</button>
                        <button class="primary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;">Selected</button>
                        <button class="secondary sfx-select-btn" style="width:auto;padding:6px 10px;display:none;" onclick="selectSfxRow(this)">Select</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div style="display:flex;justify-content:flex-end;margin-top:24px;gap:12px;">
            <button class="secondary" onclick="closeModal('sfxModal')">Cancel</button>
            <button class="primary" id="selectSfxButton" onclick="selectSoundEffect()">Select</button>
        </div>
    </div>
</div>

<!-- Volume Modal -->
<div id="volumeModal" class="volume-modal-overlay">
    <div class="volume-modal-content">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <h4 id="volumeTitle" style="margin:0;font-size:14px;font-weight:600;">Effect</h4>
            <button onclick="closeModal('volumeModal')" style="background:none;border:none;font-size:18px;cursor:pointer;color:#666;padding:0;width:20px;height:20px;">×</button>
        </div>
        
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;">
            <h4 style="writing-mode:vertical-rl;text-orientation:mixed;margin:0 0 8px 0;font-size:11px;color:#666;font-weight:500;">VOLUME</h4>
            <input type="range" id="volumeSlider" class="vertical-slider" min="0" max="100" value="75" style="height:200px;margin:8px 0;">
            <span id="volumeValue" style="font-size:14px;color:#666;margin-top:8px;font-weight:600;">75%</span>
        </div>
    </div>
</div>

<script>
const importBtn = document.getElementById('importBtn');
const input = document.getElementById('importInput');
const importedDiv = document.getElementById('importedFile');
const fileNameSpan = document.getElementById('fileName');
const removeBtn = document.getElementById('removeFileBtn');
const toneGroup = document.getElementById('toneGroup');
const voicePrefGroup = document.getElementById('voicePrefGroup');
const promptEl = document.getElementById('prompt');

importBtn.addEventListener('click', () => {
  input.click();
});

input.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  fileNameSpan.textContent = file.name;
  importedDiv.style.display = 'flex';
  toneGroup.classList.add('disabled-group');
  voicePrefGroup.classList.add('disabled-group');
  const token = 'voice:imported';
  if (!promptEl.value.includes(token)) {
    promptEl.value = promptEl.value.trim() ? promptEl.value + ' ' + token : token;
  }
});

removeBtn.addEventListener('click', () => {
  input.value = '';
  importedDiv.style.display = 'none';
  toneGroup.classList.remove('disabled-group');
  voicePrefGroup.classList.remove('disabled-group');
  promptEl.value = promptEl.value.replace(/\bvoice:imported\b/, '').trim();
});

// Voice and music search functionality
document.addEventListener('DOMContentLoaded', function() {
  const setupTweakPanelSearch = function(card) {
    const voiceSearch = card.querySelector('input[placeholder="Search voices..."]');
    const musicSearch = card.querySelector('input[placeholder="Search music..."]');
    
    if (voiceSearch) {
      voiceSearch.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        card.querySelectorAll('.voice-row').forEach(row => {
          const name = row.querySelector('.voice-name').textContent.toLowerCase();
          const desc = row.querySelector('.voice-desc').textContent.toLowerCase();
          row.style.display = (name.includes(query) || desc.includes(query)) ? '' : 'none';
        });
      });
    }
    
    if (musicSearch) {
      musicSearch.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        card.querySelectorAll('.music-row').forEach(row => {
          const name = row.querySelector('.music-name').textContent.toLowerCase();
          const desc = row.querySelector('.music-desc').textContent.toLowerCase();
          row.style.display = (name.includes(query) || desc.includes(query)) ? '' : 'none';
        });
      });
    }
  };
  
  // Setup search for initial tweak panels
  document.querySelectorAll('.output-card').forEach(setupTweakPanelSearch);
  
  // Setup genre chip clicking in create music modal
  document.querySelectorAll('#createMusicModal .chip').forEach(chip => {
    chip.addEventListener('click', function() {
      this.classList.toggle('active');
    });
  });
  
  // Setup voice row clicking
  document.querySelectorAll('.voice-row').forEach(row => {
    row.addEventListener('click', function(e) {
      // Don't select if clicking a button or icon
      if (e.target.closest('button') || e.target.closest('span[onclick]')) return;
      
      // Remove selection from all rows
      document.querySelectorAll('.voice-row').forEach(r => r.classList.remove('selected'));
      
      // Select this row
      this.classList.add('selected');
    });
  });
  
  // Setup music row clicking
  document.querySelectorAll('.music-row').forEach(row => {
    row.addEventListener('click', function(e) {
      // Don't select if clicking a button
      if (e.target.closest('button')) return;
      
      // Remove selection from all rows
      document.querySelectorAll('.music-row').forEach(r => r.classList.remove('selected'));
      
      // Select this row
      this.classList.add('selected');
    });
  });
  
  // Setup SFX modal row clicking
  document.querySelectorAll('.sfx-modal-row').forEach(row => {
    row.addEventListener('click', function(e) {
      // Don't select if clicking a button
      if (e.target.closest('button')) return;
      
      // Remove selection from all rows
      document.querySelectorAll('.sfx-modal-row').forEach(r => r.classList.remove('selected'));
      
      // Select this row
      this.classList.add('selected');
    });
  });
  
  // Setup SFX search
  const sfxSearchInput = document.getElementById('sfxSearchInput');
  if (sfxSearchInput) {
    sfxSearchInput.addEventListener('input', function() {
      const query = this.value.toLowerCase();
      document.querySelectorAll('.sfx-modal-row').forEach(row => {
        const name = row.querySelector('div[style*="font-weight:600"]').textContent.toLowerCase();
        const desc = row.querySelector('div[style*="color:#666"]').textContent.toLowerCase();
        row.style.display = (name.includes(query) || desc.includes(query)) ? 'flex' : 'none';
      });
    });
  }
});

// Preview selection functionality
function selectPreview(button) {
  // Remove selected class from all output cards
  document.querySelectorAll('.output-card').forEach(card => {
    card.classList.remove('selected');
    const selectBtn = card.querySelector('.btn-select');
    if (selectBtn) {
      selectBtn.textContent = 'Select';
    }
  });
  
  // Add selected class to the clicked card
  const card = button.closest('.output-card');
  card.classList.add('selected');
  button.textContent = 'Selected';
}

// Save and Download functionality
function saveAndDownload() {
  console.log('Saving and downloading ad...');
  // Here you would implement the actual save and download logic
}

// Share functionality
function shareAd() {
  console.log('Sharing ad...');
  // Here you would implement the sharing logic
}

// History panel toggle
document.getElementById('historyBtn').addEventListener('click', function() {
  const historyDrawer = document.getElementById('historyDrawer');
  historyDrawer.classList.toggle('open');
});

// Timing handle drag functionality
function initTimingHandles() {
  const handles = document.querySelectorAll('.timing-handle');
  
  handles.forEach(handle => {
    let isDragging = false;
    let startX = 0;
    let startLeft = 0;
    
    handle.addEventListener('mousedown', (e) => {
      isDragging = true;
      startX = e.clientX;
      startLeft = parseFloat(handle.style.left) || 0;
      handle.style.cursor = 'grabbing';
      e.preventDefault();
    });
    
    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const track = handle.parentElement;
      const trackRect = track.getBoundingClientRect();
      const trackWidth = trackRect.width;
      
      const deltaX = e.clientX - startX;
      const deltaPercent = (deltaX / trackWidth) * 100;
      let newLeft = startLeft + deltaPercent;
      
      // Constrain to track bounds (0% to 95% to leave room for duration line)
      newLeft = Math.max(0, Math.min(95, newLeft));
      
      handle.style.left = newLeft + '%';
      
      // Update duration line position
      const durationLine = track.querySelector('.duration-line');
      if (durationLine) {
        durationLine.style.left = newLeft + '%';
        // Ensure duration line doesn't extend beyond track
        const lineWidth = parseFloat(durationLine.style.width) || 10;
        const maxWidth = 100 - newLeft;
        durationLine.style.width = Math.min(lineWidth, maxWidth) + '%';
      }
    });
    
    document.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        handle.style.cursor = 'pointer';
      }
    });
  });
}

// Initialize timing handles when page loads
document.addEventListener('DOMContentLoaded', initTimingHandles);

// Modal functions
function openVoiceModal() {
  document.getElementById('voiceModal').style.display = 'flex';
}

function openMusicModal() {
  document.getElementById('musicModal').style.display = 'flex';
}

function openVoiceDirectionModal(voiceName) {
  document.getElementById('voiceDirectionModal').style.display = 'flex';
  // Store the voice name for reference
  document.getElementById('voiceDirectionModal').dataset.voiceName = voiceName;
}

function applyVoiceDirection() {
  const direction = document.getElementById('voiceDirectionText').value;
  const voiceName = document.getElementById('voiceDirectionModal').dataset.voiceName;
  
  // Here you would normally save the direction
  console.log(`Voice direction for ${voiceName}: ${direction}`);
  
  // Close the modal
  closeModal('voiceDirectionModal');
}

function openVoice2VoiceModal(voiceName) {
  document.getElementById('voice2voiceModal').style.display = 'flex';
  document.getElementById('voice2voiceTitle').textContent = `Voice change to ${voiceName}`;
  document.getElementById('targetVoiceName').textContent = voiceName;
  
  // Get the narration text from the voice modal
  const narrationText = document.querySelector('#voiceModal textarea').value || 'Grab a lush Christmas tree for only €100 – while stocks last!';
  document.getElementById('voice2voiceText').textContent = narrationText;
  
  // Reset the recording state
  resetRecording();
}

let isRecording = false;
let recordingTimeout;

function toggleRecording() {
  const recordButton = document.getElementById('recordButton');
  const recordingStatus = document.getElementById('recordingStatus');
  const voiceChangedResult = document.getElementById('voiceChangedResult');
  const useVoiceButton = document.getElementById('useVoiceButton');
  
  if (!isRecording) {
    // Start recording
    isRecording = true;
    recordButton.style.background = '#ff6666';
    recordButton.style.transform = 'scale(1.1)';
    recordingStatus.textContent = 'Recording... Click to stop';
    
    // Add pulsing animation
    recordButton.style.animation = 'pulse 1.5s infinite';
    
  } else {
    // Stop recording
    isRecording = false;
    recordButton.style.background = '#ff4444';
    recordButton.style.transform = 'scale(1)';
    recordButton.style.animation = 'none';
    recordingStatus.textContent = 'Processing voice change...';
    recordButton.disabled = true;
    
    // Simulate processing
    setTimeout(() => {
      recordingStatus.textContent = 'Voice change complete!';
      voiceChangedResult.style.display = 'block';
      useVoiceButton.style.display = 'inline-block';
      recordButton.disabled = false;
    }, 2000);
  }
}

function resetRecording() {
  isRecording = false;
  const recordButton = document.getElementById('recordButton');
  const recordingStatus = document.getElementById('recordingStatus');
  const voiceChangedResult = document.getElementById('voiceChangedResult');
  const useVoiceButton = document.getElementById('useVoiceButton');
  
  recordButton.style.background = '#ff4444';
  recordButton.style.transform = 'scale(1)';
  recordButton.style.animation = 'none';
  recordButton.disabled = false;
  recordingStatus.textContent = 'Click to start recording';
  voiceChangedResult.style.display = 'none';
  useVoiceButton.style.display = 'none';
}

function useVoiceRecording() {
  // Here you would normally use the voice recording
  console.log('Using voice recording');
  closeModal('voice2voiceModal');
}

// SFX Modal functions
function openSfxModal() {
  document.getElementById('sfxModal').style.display = 'flex';
  // Reset selection
  document.querySelectorAll('.sfx-modal-row').forEach(row => {
    row.classList.remove('selected');
  });
}

function playsfxSample(sfxName) {
  console.log(`Playing SFX sample: ${sfxName}`);
  // Here you would play the actual sound effect
}

let selectedSfx = null;

function selectSoundEffect() {
  const selectedRow = document.querySelector('.sfx-modal-row.selected');
  if (selectedRow) {
    const sfxName = selectedRow.querySelector('div[style*="font-weight:600"]').textContent;
    console.log(`Selected SFX: ${sfxName}`);
    
    // Add the SFX to the timing panel (this would be more sophisticated in production)
    addSfxToTimingPanel(sfxName);
    
    closeModal('sfxModal');
  } else {
    alert('Please select a sound effect');
  }
}

function addSfxToTimingPanel(sfxName) {
  // Here you would add the SFX to the timing panel
  console.log(`Adding ${sfxName} to timing panel`);
}

function selectSfxRow(button) {
  const row = button.closest('.sfx-modal-row');
  
  // Remove selection from all rows
  document.querySelectorAll('.sfx-modal-row').forEach(r => r.classList.remove('selected'));
  
  // Select this row
  row.classList.add('selected');
}

function selectVoiceRow(button) {
  const row = button.closest('.voice-row');
  
  // Remove selection from all rows
  document.querySelectorAll('.voice-row').forEach(r => r.classList.remove('selected'));
  
  // Select this row
  row.classList.add('selected');
}

function selectMusicRow(button) {
  const row = button.closest('.music-row');
  
  // Remove selection from all rows
  document.querySelectorAll('.music-row').forEach(r => r.classList.remove('selected'));
  
  // Select this row
  row.classList.add('selected');
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

function openCreateMusicModal() {
  document.getElementById('createMusicModal').style.display = 'flex';
  // Reset the form
  document.getElementById('musicDescription').value = '';
  document.getElementById('generatedMusicSection').style.display = 'none';
  document.querySelectorAll('#createMusicModal .chip').forEach(chip => chip.classList.remove('active'));
}

function generateMusicBed(button) {
  const originalText = button.textContent;
  const generatedSection = document.getElementById('generatedMusicSection');
  
  // Disable button and show progress
  button.disabled = true;
  button.textContent = 'Generating...';
  
  // Simulate progress with dots
  let dots = 0;
  const progressInterval = setInterval(() => {
    dots = (dots + 1) % 4;
    button.textContent = 'Generating' + '.'.repeat(dots);
  }, 500);
  
  // Complete generation after 2 seconds
  setTimeout(() => {
    clearInterval(progressInterval);
    button.disabled = false;
    button.textContent = originalText;
    
    // Show generated music options
    generatedSection.style.display = 'block';
    
    // Smooth scroll to generated section
    generatedSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }, 2000);
}

function selectGeneratedMusic(row, musicName) {
  // Add the new music to the main music list
  const musicList = document.querySelector('#musicModal .music-list');
  const newMusicRow = document.createElement('div');
  newMusicRow.className = 'music-row';
  newMusicRow.style.borderColor = '#0066FF';
  newMusicRow.style.background = '#f8fafd';
  newMusicRow.innerHTML = `
    <div class="music-left">
      <div class="music-name">${musicName}</div>
      <div class="music-desc">Custom generated music bed</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;">
      <button class="secondary" style="width:auto;padding:6px 10px;display:flex;align-items:center;gap:4px;">▶️ Play</button>
      <button class="primary" style="width:auto;padding:6px 10px;">Selected</button>
    </div>
  `;
  
  // Deselect all other music
  musicList.querySelectorAll('.music-row').forEach(r => {
    r.style.borderColor = '#e0e4e8';
    r.style.background = '#fff';
    const btn = r.querySelector('button:last-child');
    if (btn) {
      btn.className = 'secondary';
      btn.textContent = 'Select';
    }
  });
  
  // Insert at the top of the list
  musicList.insertBefore(newMusicRow, musicList.firstChild);
  
  // Close both modals
  closeModal('createMusicModal');
  closeModal('musicModal');
}

function openVolumeModal(effectName, currentVolume, buttonElement) {
  const modal = document.getElementById('volumeModal');
  const modalContent = modal.querySelector('.volume-modal-content');
  
  // Update modal content
  document.getElementById('volumeTitle').textContent = effectName;
  document.getElementById('volumeSlider').value = currentVolume;
  document.getElementById('volumeValue').textContent = currentVolume + '%';
  
  // Position modal next to the button
  const buttonRect = buttonElement.getBoundingClientRect();
  const modalWidth = 180;
  const modalHeight = 320;
  
  // Calculate position (to the right of button, or left if not enough space)
  let left = buttonRect.right + 10;
  let top = buttonRect.top - (modalHeight / 2) + (buttonRect.height / 2);
  
  // Check if modal would go off screen to the right
  if (left + modalWidth > window.innerWidth) {
    left = buttonRect.left - modalWidth - 10;
  }
  
  // Check if modal would go off screen top/bottom
  if (top < 10) top = 10;
  if (top + modalHeight > window.innerHeight - 10) {
    top = window.innerHeight - modalHeight - 10;
  }
  
  modalContent.style.left = left + 'px';
  modalContent.style.top = top + 'px';
  
  modal.style.display = 'block';
}

// Update volume value display when slider changes
document.addEventListener('DOMContentLoaded', function() {
  const volumeSlider = document.getElementById('volumeSlider');
  const volumeValue = document.getElementById('volumeValue');
  
  if (volumeSlider && volumeValue) {
    volumeSlider.addEventListener('input', function() {
      volumeValue.textContent = this.value + '%';
    });
  }
});

// Audio Player Functions
function toggleAudioPlayer(button) {
  const playIcon = button.querySelector('.play-icon');
  const isPlaying = button.dataset.playing === 'true';
  const audioPlayer = button.closest('.audio-player');
  
  // Check if player is disabled
  if (audioPlayer.style.opacity === '0.5') {
    return; // Don't allow interaction when disabled
  }
  
  // Stop all other players
  document.querySelectorAll('.play-button').forEach(otherButton => {
    if (otherButton !== button) {
      const otherIcon = otherButton.querySelector('.play-icon');
      otherButton.dataset.playing = 'false';
      // Reset to play icon
      otherIcon.style.background = 'none';
      otherIcon.style.width = '0';
      otherIcon.style.height = '0';
      otherIcon.style.borderLeft = '8px solid #4a4a4a';
      otherIcon.style.borderTop = '6px solid transparent';
      otherIcon.style.borderBottom = '6px solid transparent';
      otherIcon.style.marginLeft = '2px';
    }
  });
  
  if (!isPlaying) {
    // Change to pause icon
    playIcon.style.border = 'none';
    playIcon.style.width = '12px';
    playIcon.style.height = '12px';
    playIcon.style.background = 'linear-gradient(to right, #4a4a4a 0%, #4a4a4a 35%, transparent 35%, transparent 65%, #4a4a4a 65%, #4a4a4a 100%)';
    playIcon.style.marginLeft = '0';
    button.dataset.playing = 'true';
  } else {
    // Change to play icon
    playIcon.style.background = 'none';
    playIcon.style.width = '0';
    playIcon.style.height = '0';
    playIcon.style.borderLeft = '8px solid #4a4a4a';
    playIcon.style.borderTop = '6px solid transparent';
    playIcon.style.borderBottom = '6px solid transparent';
    playIcon.style.marginLeft = '2px';
    button.dataset.playing = 'false';
  }
}

// Generation simulation function
function simulateGeneration(button) {
  const originalText = button.textContent;
  const tweakPanel = button.closest('.tweak-panel');
  const audioPlayer = tweakPanel.querySelector('.audio-player');
  
  // Disable button and show progress
  button.disabled = true;
  button.textContent = 'Generating...';
  
  // Disable audio player
  audioPlayer.style.opacity = '0.5';
  audioPlayer.style.pointerEvents = 'none';
  
  // Simulate progress with dots
  let dots = 0;
  const progressInterval = setInterval(() => {
    dots = (dots + 1) % 4;
    button.textContent = 'Generating' + '.'.repeat(dots);
  }, 500);
  
  // Complete generation after 3 seconds
  setTimeout(() => {
    clearInterval(progressInterval);
    button.disabled = false;
    button.textContent = originalText;
    
    // Re-enable audio player
    audioPlayer.style.opacity = '1';
    audioPlayer.style.pointerEvents = 'auto';
    
    // Update track title to show it's been regenerated
    const trackTitle = audioPlayer.querySelector('.track-title');
    trackTitle.textContent = 'Regenerated Preview';
    
    // Reset progress bar
    const progressFill = audioPlayer.querySelector('.progress-fill');
    const progressHandle = audioPlayer.querySelector('.progress-handle');
    const currentTime = audioPlayer.querySelector('.time-display:first-child');
    
    progressFill.style.width = '0%';
    progressHandle.style.left = '0%';
    currentTime.textContent = '0:00';
  }, 3000);
}

function setAudioProgress(progressBar, event) {
  const audioPlayer = progressBar.closest('.audio-player');
  
  // Check if player is disabled
  if (audioPlayer.style.opacity === '0.5') {
    return; // Don't allow interaction when disabled
  }
  
  const rect = progressBar.getBoundingClientRect();
  const clickX = event.clientX - rect.left;
  const percentage = Math.max(0, Math.min(100, (clickX / rect.width) * 100));
  
  const progressFill = progressBar.querySelector('.progress-fill');
  const progressHandle = progressBar.querySelector('.progress-handle');
  const currentTimeEl = progressBar.parentElement.querySelector('.time-display:first-child');
  
  progressFill.style.width = percentage + '%';
  progressHandle.style.left = percentage + '%';
  
  // Update time display (assuming 12 second duration)
  const totalSeconds = 12;
  const currentSeconds = Math.floor((percentage / 100) * totalSeconds);
  currentTimeEl.textContent = `0:${currentSeconds.toString().padStart(2, '0')}`;
}

// Close modal when clicking outside content
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('modal-overlay')) {
    e.target.style.display = 'none';
  }
  // Close volume modal when clicking outside
  if (e.target.classList.contains('volume-modal-overlay')) {
    e.target.style.display = 'none';
  }
});

// Handle Generate/Play button clicks
document.addEventListener('click', function(e) {
  if (e.target.dataset.voice && e.target.textContent === 'Generate') {
    // Simulate generation
    const originalText = e.target.textContent;
    e.target.disabled = true;
    e.target.textContent = 'Generating...';
    
    setTimeout(() => {
      e.target.disabled = false;
      e.target.textContent = 'Play';
      e.target.dataset.generated = 'true';
      e.target.classList.remove('secondary');
      e.target.classList.add('primary');
    }, 2000);
  }
});
</script>
</body>
</html>